# Firebaseの基礎を学ぼう

## Firebaseとは? 

FirebaseはGoogleによって運営されているサービスです。Firebaseを利用することで、本来はサーバーサイドの実装が必要だったユーザー認証やデータのやり取りをサーバーサイドプログラミングを知らない人でも簡単に行うことが出来るようになりました。また、チャットアプリなどリアルタイムなデータのやり取りが必要なサイトでもよく利用されています。Firebaseは無料で利用開始することが出来、今回のアプリでは課金などありませんので安心してください。

## Firebaseにプロジェクトを作ろう

![Firebase-top](https://firebasestorage.googleapis.com/v0/b/codegrit-images.appspot.com/o/codegrit-react%2FLesson10%2Ffirebase-top.png?alt=media&token=59768327-cd3f-41f0-ae31-88ea7162da3b)

早速Firebaseで今回作成するクイズアプリのプロジェクトを作成していきましょう。まずはFirebaseのサイトにアクセスしてください。

[Firebase公式](https://firebase.google.com/)

Googleのアカウントを持っている方は、Googleアカウントでログイン出来ます。ない方はGoogleアカウントを作成してログインしましょう。

ログインすると、右上のメニューからコンソール(管理画面)に入ることが出来ます。すると以下のような画面が出てくるはずです。

![Firebase-dashboard](https://firebasestorage.googleapis.com/v0/b/codegrit-images.appspot.com/o/codegrit-react%2FLesson10%2Ffirebase-dashboard.png?alt=media&token=c5164760-0661-4d2c-8615-5056255064b6)

ダッシュボード上で「プロジェクトを追加」をクリックします。するとモダルウィンドウが立ち上がりますので、以下のように編集して作成してください。

- プロジェクト名 - 自由です。(例: My Quiz App)
- 地域 - 日本
- ロケーション - asia-northeast1

作成するとプロジェクトのダッシュボードへ移動します。

## データベースを利用する

さて、フロントエンド開発のコースではこれまでデータはJSONやオブジェクト形式で保存したものを読み取って使うということをしてきました。しかし、 データ量が大きい場合やデータの保存が必要なサービスの場合はクライアントサイド側だけではデータを上手く扱うことが出来ません。そこで必要なのがデータベースです。

FirebaseはCloud Firestoreと呼ばれるデータベースを提供しており、今回のアプリはこのデータベース上にクイズの問題や回答、クイズの回答結果などのデータを保存していきます。

注意点として、Firebaseではこれまでは`Realtime Database`と呼ばれるデータベースが主流で、まだこちらも提供しております。ただし`Cloud Firestore`がより新しくこれから主流となると考えられるため、このレッスンでは`Cloud Firestore`を利用します。

## データベースの種類

データベースには大きく分けて2つがあります。一つはリレーショナルデータベースでもう一つはNoSQLデータベースです。リレーショナルデータベースについてはサーバーサイド開発のプログラムで学ぶことになります。今回利用するCloud FirestoreはNoSQLデータベースの一つとなります。

## Cloud Firestoreの基礎

Cloud Firestoreには以下のような特徴があります。

- スケールしやすい
- 順番を持たない

SQLの場合は一般的にデータは1,2,3,4と順番に保存されていきます。しかし、NoSQLの場合はデータの順番というものがありません。そのためデータを順番に取ってきたい場合には例えば、データが作成された日時でデータ一覧を並び替える必要があります。このようにすることによって、Cloud Firestoreでは、データを複数サーバーに分けて保存することが簡単に出来、データ量が将来的に莫大になっても上手く扱えるようになっています。

SQLについても知っているとこの内容はより理解しやすいですが、現状としてはCloud Datastoreはデータ量に関わらず安定して使えると理解していれば大丈夫です。

## データ構造

Cloud Firestoreに保存されるデータの構造は非常にシンプルです。

### コレクションとドキュメント

- コレクション

Cloud Datastoreで重要な2つの概念がコレクションとドキュメントです。コレクションとは、簡単に言うと保存されるデータが一種類に限定されたパソコンのフォルダのようなものです。

例えば、レストランを紹介するサイトを作るとしましょう。この時には、例えばレストランのリストを扱うためのコレクションを`restaurants`という名前で作成することが出来ます。

- ドキュメント

一つのレストランは様々な情報を持つはずです。例えば、レストランの名前、住所、開店や閉店の時間、定休日、定員などです。こうしたデータをまとめて保存したものをドキュメントと呼びます。各ドキュメントは必ずID(ドキュメントID)を持ちます。IDは社員証や学生証、免許証などにもありますのでおなじみの概念かと思いますが、あるデータが識別できるようにするものであれ重複の無い数値や文字列を利用します。NoSQLでは文字列を使います。

### サブコレクションとマップ

ところで、レストラン紹介サイトを作るなら他にも入れたいデータがありますよね。例えば、メニュー一覧がそうです。しかしそれぞれのメニューも名前や値段など複数のデータを持っています。

こうしたケースで利用できるのが、サブコレクションやマップです。

- サブコレクション

サブコレクションはコレクションの持つドキュメントが持つコレクションのことです。後ほど解説しますが、メニュー一覧やレビュー一覧はマップよりもサブコレクションに保存すると便利です。

- マップ

時には名前や住所をカタカナ、ローマ字、漢字など複数のフォーマットで持ちたい場合があるでしょう。こうした時にドキュメント内のデータを次のようにネストして保存することが出来ます。このようにネストされたデータのことをマップと呼びます。

```
- name
  - kanji: 優勝軒
  - カタカナ: ユウショウケン
  - romaji: yuushoken
```

ネストは複数改装とることが出来るので、リストのように利用することも出来ます。

## 今回のアプリで利用しているデータ

さて、アプリのページは既にご覧になったでしょうか? まだ見ていない方は以下のURLよりまずはアプリを見てみましょう。

- [MyQuiz App](https://myquiz-app-cecc8.firebaseapp.com/)

ご覧頂いて、どんなデータが読み込まれているのか予測はつくでしょうか？ まず思い浮かぶのはQuizそのものだと思います。オブジェクト形式で書くとこのような形です。

```js
const quizData = {
  title: "クイズのタイトル" // 「あなたはどれくらい分かる？...」の部分
  descriptin: "クイズの説明" // 「あなたはテニスが好きですか?...」の部分
}
```

クイズには、何個かの設問がついています。この設問のことをこのアプリでは`QuizItem`と呼んでます。`Quiz`コレクションが複数の`QuizItem`サブコレクションを持つという構造になります。

一つ一つの設問を見ていくと、分かる通り、設問ごとに回答の選択肢が複数個(今回のアプリでは4個)あります。これらの選択肢のことを今回のアプリでは`QuizOption`と呼びましょう。

そうすると、先程`Quiz`が`QuizItem`をサブコレクションとして持っていたのと同様に、`QuizItem`は`QuizOption`をサブコレクションとして持つという風に関係性が見えて来ます。

ここまでのことを視覚化してみると以下の画像のようになります。

![myquizのデータモデル](https://firebasestorage.googleapis.com/v0/b/codegrit-images.appspot.com/o/codegrit-react%2FLesson10%2Fmyquiz-datamodel.png?alt=media&token=6c9f8b42-fbbc-4cfa-82c0-37b3f79d7a3f)
